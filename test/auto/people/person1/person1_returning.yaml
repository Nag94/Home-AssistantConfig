initial_state: "on"
alias: "Pete returning"
trigger:
  platform: state
  entity_id: device_tracker.Pete_mobile
  from: "work"
  to: "not_home"
condition:
  condition: and
  conditions:
    - condition: state
      entity_id: input_boolean.adults_away
      state: "off"
    - condition: or
      conditions:
        - condition: time
          after: "15:00:00"
          weekday:
            - mon
            - tue
            - wed
            - thu
        - condition: time
          after: "12:00:00"
          weekday:
            - fri
    - condition: state
      entity_id: input_boolean.Pete_home
      state: "off"
action:
  - choose:
      - conditions:
          - condition: state
            entity_id: input_boolean.person3_home
            state: "on"
        sequence:
          - service: notify.person3
            data:
              message: "Pete should be home from work in about {{ (states('sensor.Petes_time_to_home')|int)*2 }} {{ state_attr('sensor.Petes_time_to_home','unit_of_measurement') }}"
      - conditions:
          - condition: state
            entity_id: input_boolean.Julie_home
            state: "on"
        sequence:
          - service: notify.discord_webhook
            data:
              title: "Pete returning"
              message: "Pete should be home from work in about {{ (states('sensor.Petes_time_to_home')|int)*2 }} {{ state_attr('sensor.Petes_time_to_home','unit_of_measurement') }}"
