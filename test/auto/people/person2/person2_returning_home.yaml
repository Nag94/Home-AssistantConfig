alias: "Julie returning home"
initial_state: "on"
trigger:
  - platform: event
    event_type: tasker_webhook
    event_data:
      who: Julie
condition:
  condition: and
  conditions:
    - condition: state
      entity_id: input_boolean.adults_away
      state: "off"
    - condition: state
      entity_id: input_boolean.Julie_home
      state: "off"
    # In, or leaving, the car
    - condition: template
      value_template: >-
        {{ 'BT Car' in trigger.event.data.what }}
    - condition: template
      value_template: >-
        {{ not is_state('device_tracker.Julie_mobile_gps','not_home') }}
action:
  - service: automation.turn_off
    data:
      entity_id: automation.Julie_returning_home
      #stop_actions: false
  - service: script.Julie_traveltime
  # Wait 30 seconds for the update
  - delay: "00:00:30"
  - service: notify.logfile
    data:
      message: "SENDperson3 Julie should be home from {{ states('device_tracker.Julie_mobile_gps') }} in around {%- set travel_time = states('sensor.Julies_time_to_home') %} {{ travel_time[0] }} to {{ travel_time[0] | int + 25 }} {{ travel_time[1] }}{{ state_attr('sensor.Julies_time_to_home','unit_of_measurement') }}"
